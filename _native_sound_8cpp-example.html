<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>JNIpp: NativeSound.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">JNIpp&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">JNI meets C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_native_sound_8cpp-example.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">NativeSound.cpp</div>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;NativeSound.h&quot;</span>

<span class="comment">/***************************************/</span>

<span class="comment">/* One good place to call NativeSound::RegisterCallbacks()</span>
<span class="comment"> *  is JNI_OnLoad function.</span>
<span class="comment"> */</span>
<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> jint JNI_OnLoad(JavaVM* vm,<span class="keywordtype">void</span>* reserved) {
    
    <span class="comment">// Initialize jni:: first.</span>
    <a name="a0"></a><a class="code" href="namespacejni.html#a841cd5ac0f66b6d37f3b0d14d97a1890" title="Initializes jni; must be called before any other jni function.">jni::Initialize</a>(vm);

    <span class="comment">// Register callbacks.</span>
    NativeSound::RegisterCallbacks();

    <span class="keywordflow">return</span> JNI_VERSION_1_4;
}


<span class="comment">/***************************************/</span>

<span class="comment">/* Implementation of NativeSoundException class.</span>
<span class="comment"> */</span>

<span class="preprocessor">#define JB_CURRENT_CLASS NativeSoundException</span>
<span class="preprocessor"></span>
<a name="a1"></a><a class="code" href="_java_binding_8h.html#ad0c4f80cfc9760c92307575e6342a1e7" title="Defines Java bindings for the current wrapper class.">JB_DEFINE_WRAPPER_CLASS</a>(
    <span class="stringliteral">&quot;NativeSoundException&quot;</span>
    ,
    NoFields
    ,
    Methods
    (
        Constructor,
        <span class="stringliteral">&quot;&lt;init&gt;&quot;</span>,<span class="stringliteral">&quot;(Ljava/lang/String;)V&quot;</span>
    )
)

<span class="comment">/* ATTENTION!</span>
<span class="comment"> * Note that we are NOT calling Exception(PString) constructor</span>
<span class="comment"> *  from base class. That is because it would create Java object of</span>
<span class="comment"> *  wrong type (java.lang.Exception).</span>
<span class="comment"> * Instead we are creating Java object by ourselves and calling</span>
<span class="comment"> *  wrapping constructor Exception(const jni::LObject&amp;).</span>
<span class="comment"> */</span>
NativeSoundException::NativeSoundException(const <span class="keywordtype">char</span>* message):
    java::Exception(<a name="a2"></a><a class="code" href="_java_binding_8h.html#a39836eb30974f0996efabe26e02dc297" title="Allocates new instance of Java class and calls constructor method identified by ConstructorTag.">JB_NEW</a>(Constructor,java::<a name="a3"></a><a class="code" href="namespacejava.html#a2c8e044fce146c4e355d34139eb38921" title="Pointer to String.">PString</a>::New(message)))
{
}
NativeSoundException::NativeSoundException(<a name="_a4"></a><a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PString</a> message):
    java::Exception(<a class="code" href="_java_binding_8h.html#a39836eb30974f0996efabe26e02dc297" title="Allocates new instance of Java class and calls constructor method identified by ConstructorTag.">JB_NEW</a>(Constructor,message))
{
}

<span class="preprocessor">#undef JB_CURRENT_CLASS</span>
<span class="preprocessor"></span>

<span class="comment">/***************************************/</span>

<span class="comment">/* Implementation of NativeSoundCheckpoint class.</span>
<span class="comment"> */</span>

<span class="preprocessor">#define JB_CURRENT_CLASS NativeSoundCheckpoint</span>
<span class="preprocessor"></span>
<a class="code" href="_java_binding_8h.html#ad0c4f80cfc9760c92307575e6342a1e7" title="Defines Java bindings for the current wrapper class.">JB_DEFINE_WRAPPER_CLASS</a>(
    <span class="stringliteral">&quot;NativeSound$Checkpoint&quot;</span>
    ,
    Fields
    (
        Time,
         <span class="stringliteral">&quot;time&quot;</span>,<span class="stringliteral">&quot;J&quot;</span>
    )
    (
        Data,
        <span class="stringliteral">&quot;data&quot;</span>,<span class="stringliteral">&quot;Ljava/lang/Object;&quot;</span>
    )
    ,
    NoMethods
)

NativeSoundCheckpoint::NativeSoundCheckpoint(const jni::LObject&amp; checkpoint):
    java::Object(checkpoint)
{
}
    
jlong NativeSoundCheckpoint::GetTime()<span class="keyword"> const </span>{
    <span class="keywordflow">return</span> <a name="a5"></a><a class="code" href="_java_binding_8h.html#adbb1aa9f9429c0322693a9df868e4930" title="Retrieves value of the field identified by FieldTag from the current object; use in member functions...">JB_GET_THIS</a>(LongField,Time);
}

<a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PObject</a> NativeSoundCheckpoint::GetData()<span class="keyword"> const </span>{
    <span class="keywordflow">return</span> <a name="a6"></a><a class="code" href="classjava_1_1_object_pointer.html#aa963c0886e2353e9e10631076f8a7ce5" title="Creates object pointer from local object.">java::PObject::Wrap</a>(<a class="code" href="_java_binding_8h.html#adbb1aa9f9429c0322693a9df868e4930" title="Retrieves value of the field identified by FieldTag from the current object; use in member functions...">JB_GET_THIS</a>(ObjectField,Data));
}

<span class="preprocessor">#undef JB_CURRENT_CLASS</span>
<span class="preprocessor"></span>

<span class="comment">/***************************************/</span>

<span class="comment">/* Implementation of NativeSound class.</span>
<span class="comment"> */</span>

<span class="preprocessor">#define JB_CURRENT_CLASS NativeSound</span>
<span class="preprocessor"></span>
<a name="a7"></a><a class="code" href="_java_binding_8h.html#a0ebad81e8e051c6b3c242f456d4ebf53" title="Defines Java bindings for the current live class.">JB_DEFINE_LIVE_CLASS</a>(
    <span class="stringliteral">&quot;NativeSound&quot;</span>
    ,
    NoFields
    ,
    NoMethods
    ,
    Callbacks
    (
        Method(Construct),
        <span class="stringliteral">&quot;construct&quot;</span>,<span class="stringliteral">&quot;(Ljava/lang/String;)V&quot;</span>
    )
    (
        Method(GetPath),
        <span class="stringliteral">&quot;getPath&quot;</span>,<span class="stringliteral">&quot;()Ljava/lang/String;&quot;</span>
    )
    (
        Method(SetCheckpoints),
        <span class="stringliteral">&quot;setCheckpoints&quot;</span>,<span class="stringliteral">&quot;([LNativeSound$Checkpoint;)V&quot;</span>
    )
    (
        Method(Play),
        <span class="stringliteral">&quot;play&quot;</span>,<span class="stringliteral">&quot;()V&quot;</span>
    )
    (
        Method(Stop),
        <span class="stringliteral">&quot;stop&quot;</span>,<span class="stringliteral">&quot;()V&quot;</span>
    )
)

void NativeSound::RegisterCallbacks() {
    <a name="a8"></a><a class="code" href="_java_binding_8h.html#afabace31d8e9d7d357c1c34a851f2bf4" title="Initializes data structures defined by JB_DEFINE_ macros.">JB_INIT_CLASS</a>();
}

<span class="keywordtype">void</span> NativeSound::Construct(<span class="keyword">const</span> <a name="_a9"></a><a class="code" href="classjni_1_1_l_object.html" title="Wrapper for local Java objects.">jni::LObject</a>&amp; thiz,<a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PString</a> path) {
    <span class="comment">// No leak here because instance pointer is stored in the Java</span>
    <span class="comment">//  object &#39;thiz&#39; by the live constructor </span>
    <span class="comment">//  NativeSound(const jni::LObject&amp;,jfieldID).</span>
    <span class="keyword">new</span> NativeSound(thiz,path);
}

NativeSound::NativeSound(<span class="keyword">const</span> <a class="code" href="classjni_1_1_l_object.html" title="Wrapper for local Java objects.">jni::LObject</a>&amp; thiz,<a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PString</a> path):
    java::Object(thiz,GetInstanceFieldID()),
    m_path(path)
{
    <span class="keyword">const</span> <span class="keywordtype">char</span>* utfPath=path-&gt;GetUTF();

    FILE* file=fopen(utfPath,<span class="stringliteral">&quot;r&quot;</span>);
    <span class="keywordflow">if</span> (!file) {
        <span class="comment">// The only correct syntax to throw a Java exception:</span>
        <span class="comment">//  throw object pointer by value.</span>
        <span class="keywordflow">throw</span> PNativeSoundException::New(<span class="stringliteral">&quot;Can&#39;t open file.&quot;</span>);

        <span class="comment">/*** throw new NativeSoundException(&quot;Can&#39;t open file.&quot;); ***/</span>
        <span class="comment">// This will leak pointer. Besides jni::TranslateCppException()</span>
        <span class="comment">//  doesn&#39;t recognize pointers and will translate this exception</span>
        <span class="comment">//  to generic java.lang.RuntimeException(&#39;Unknown C++ exception&#39;).</span>

        <span class="comment">/*** throw NativeSoundException(&quot;Can&#39;t open file.&quot;); ***/</span>
        <span class="comment">// This will work, but is still wrong - descendants of java::Object</span>
        <span class="comment">//  are reference counted, and should not be instantiated on a</span>
        <span class="comment">//  stack. </span>
    }

    <span class="comment">// Work with file...</span>

    fclose(file);
}

NativeSound::~NativeSound() {
    <span class="comment">// Free resources.</span>
}

<a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PString</a> NativeSound::GetPath() {
    <span class="keywordflow">return</span> m_path;
}

<span class="keywordtype">void</span> NativeSound::SetCheckpoints(PCheckpointArray checkpoints) {
    <span class="keywordflow">if</span> (checkpoints) {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i!=checkpoints-&gt;GetLength();++i) {
            PCheckpoint checkpoint=checkpoints-&gt;GetAt(i);
            jlong time=checkpoint-&gt;GetTime();
            <a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PObject</a> data=checkpoint-&gt;GetData();
            <span class="comment">// Register checkpoint.</span>
        }
    }
}

<span class="keywordtype">void</span> NativeSound::Play() {
    <span class="comment">// Play sound.</span>
}
<span class="keywordtype">void</span> NativeSound::Stop() {
    <span class="comment">// Stop sound.</span>
}

<span class="preprocessor">#undef JB_CURRENT_CLASS</span>
<span class="preprocessor"></span>

<span class="comment">/**************************************/</span>

<span class="preprocessor">#ifdef ONLY_FOR_DOXYGEN</span>
<span class="preprocessor"></span><span class="comment">// Wire this example to:</span>
<a name="_a10"></a><a class="code" href="classjava_1_1_object.html" title="The Object class, root of all.">java::Object</a>;
<a name="_a11"></a><a class="code" href="classjava_1_1_exception.html" title="Wrapper for java.lang.Exception.">java::Exception</a>;
<span class="preprocessor">#endif</span>
</pre></div> </div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jun 9 2011 00:20:03 for JNIpp by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
