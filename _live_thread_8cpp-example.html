<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>JNIpp: LiveThread.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">JNIpp&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">JNI meets C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_live_thread_8cpp-example.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">LiveThread.cpp</div>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<span class="preprocessor">#include &quot;LiveThread.h&quot;</span>

<span class="comment">/**************************************/</span>

<span class="comment">/* Demostrates two ways of starting a thread.</span>
<span class="comment"> */</span>
<span class="keywordtype">void</span> StartMyThread() {

    <span class="comment">// There is no leak.</span>
    <span class="comment">// MyThread instance stored nativeInstance variable of</span>
    <span class="comment">//  LiveThread object. When LiveThread is finalized by</span>
    <span class="comment">//  GC it also destroys native MyThread instance.</span>
    (<span class="keyword">new</span> MyThread())-&gt;Start();

    <span class="comment">// More readable alternative to the above:</span>
    PLiveThread liveThread=<span class="keyword">new</span> MyThread();
    liveThread-&gt;Start();
}

<span class="comment">/* The following function demonstrates different calls</span>
<span class="comment"> *  that are all end up in MyThread::Run().</span>
<span class="comment"> */</span>
<span class="keywordtype">void</span> CallRunVirtually() {
    
    PLiveThread liveThread=<span class="keyword">new</span> MyThread();

    <span class="comment">// This is simple: when you call Run() on LiveThread</span>
    <span class="comment">//  call ends up in MyThread::Run() because Run() is</span>
    <span class="comment">//  declared &#39;virtual&#39; in LiveThread.</span>
    liveThread-&gt;Run();

    <span class="comment">// Now if you call Run() on a Thread object, which</span>
    <span class="comment">//  doesn&#39;t declare Run() as &#39;virtual&#39;...</span>
    PThread thread=liveThread;
    thread-&gt;Run();
    <span class="comment">// ...the call ends in MyThread::Run() too! That is because</span>
    <span class="comment">// it goes through Java where all methods a virtual:</span>
    <span class="comment">// Thread::Run()-&gt;[java]Thread.run()-&gt;[java]LiveThread.run()</span>
    <span class="comment">//  -&gt;LiveThread::Run()-&gt;MyThread::Run().</span>
}

<span class="comment">/**************************************/</span>

MyThread::MyThread():
    LiveThread(java::<a name="a0"></a><a class="code" href="namespacejava.html#a2c8e044fce146c4e355d34139eb38921" title="Pointer to String.">PString</a>::New(<span class="stringliteral">&quot;MyThread&quot;</span>))
{
}

<span class="keywordtype">void</span> MyThread::Run() {
    <a name="_a1"></a><a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PString</a> name=GetName();
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i!=5;++i) {
        sleep(1);
        printf(<span class="stringliteral">&quot;%s: working...\n&quot;</span>,name-&gt;GetUTF());
    }
    printf(<span class="stringliteral">&quot;%s: done\n&quot;</span>,name-&gt;GetUTF());
}


<span class="comment">/**************************************/</span>

<span class="comment">/* Usual wrapper class implementation.</span>
<span class="comment">*/</span>

<span class="preprocessor">#define JB_CURRENT_CLASS Thread</span>
<span class="preprocessor"></span>
<a name="a2"></a><a class="code" href="_java_binding_8h.html#ad0c4f80cfc9760c92307575e6342a1e7" title="Defines Java bindings for the current wrapper class.">JB_DEFINE_WRAPPER_CLASS</a>(
    <span class="stringliteral">&quot;java/lang/Thread&quot;</span>
    ,
    NoFields
    ,
    Methods
    (
        Ctor,
        <span class="stringliteral">&quot;&lt;init&gt;&quot;</span>,<span class="stringliteral">&quot;()V&quot;</span>
    )
    (
        CtorString,
        <span class="stringliteral">&quot;&lt;init&gt;&quot;</span>,<span class="stringliteral">&quot;(Ljava/lang/String;)V&quot;</span>
    )
    (
        GetName,
        <span class="stringliteral">&quot;getName&quot;</span>,<span class="stringliteral">&quot;()Ljava/lang/String;&quot;</span>
    )
    (
        Start,
        <span class="stringliteral">&quot;start&quot;</span>,<span class="stringliteral">&quot;()V&quot;</span>
    )
    (
        Run,
        <span class="stringliteral">&quot;run&quot;</span>,<span class="stringliteral">&quot;()V&quot;</span>
    )
    (
        GetCurrentThread,
        <span class="stringliteral">&quot;+currentThread&quot;</span>,<span class="stringliteral">&quot;()Ljava/lang/Thread;&quot;</span>
    )
)

Thread::Thread():
    java::Object(<a name="a3"></a><a class="code" href="_java_binding_8h.html#a39836eb30974f0996efabe26e02dc297" title="Allocates new instance of Java class and calls constructor method identified by ConstructorTag.">JB_NEW</a>(Ctor))
{
}

Thread::Thread(<a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PString</a> name):
    java::Object(<a class="code" href="_java_binding_8h.html#a39836eb30974f0996efabe26e02dc297" title="Allocates new instance of Java class and calls constructor method identified by ConstructorTag.">JB_NEW</a>(CtorString,name))
{
}

Thread::Thread(<span class="keyword">const</span> <a name="_a4"></a><a class="code" href="classjni_1_1_l_object.html" title="Wrapper for local Java objects.">jni::LObject</a>&amp; thread):
    java::Object(thread)
{
}

Thread::Thread(<span class="keyword">const</span> <a class="code" href="classjni_1_1_l_object.html" title="Wrapper for local Java objects.">jni::LObject</a>&amp; <span class="keywordtype">object</span>,jfieldID instanceFieldID):
    java::Object(object,instanceFieldID)
{
}

<a class="code" href="classjava_1_1_object_pointer.html" title="Smart pointer for classes derived from Object.">java::PString</a> Thread::GetName()<span class="keyword"> const </span>{
    <span class="keywordflow">return</span> <a name="a5"></a><a class="code" href="classjava_1_1_object_pointer.html#aa963c0886e2353e9e10631076f8a7ce5" title="Creates object pointer from local object.">java::PString::Wrap</a>(<a name="a6"></a><a class="code" href="_java_binding_8h.html#a3715efe639bf5a13c8e4e8603e2fc1c3" title="Calls method identified by MethodTag on the current object; use in member functions.">JB_CALL_THIS</a>(ObjectMethod,GetName));
}

<span class="keywordtype">void</span> Thread::Start() {
    <a class="code" href="_java_binding_8h.html#a3715efe639bf5a13c8e4e8603e2fc1c3" title="Calls method identified by MethodTag on the current object; use in member functions.">JB_CALL_THIS</a>(VoidMethod,Start);
}

<span class="keywordtype">void</span> Thread::Run() {
    <a class="code" href="_java_binding_8h.html#a3715efe639bf5a13c8e4e8603e2fc1c3" title="Calls method identified by MethodTag on the current object; use in member functions.">JB_CALL_THIS</a>(VoidMethod,Run);
}
    
PThread Thread::GetCurrentThread() {
    <span class="keywordflow">return</span> PThread::Wrap(<a name="a7"></a><a class="code" href="_java_binding_8h.html#a4edd71ef59c52e42356f00bf1bdd8a17" title="Calls static method identified by MethodTag.">JB_CALL_STATIC</a>(ObjectMethod,GetCurrentThread));
}

<span class="preprocessor">#undef JB_CURRENT_CLASS</span>
<span class="preprocessor"></span>

<span class="comment">/**************************************/</span>

<span class="preprocessor">#define JB_CURRENT_CLASS LiveThread</span>
<span class="preprocessor"></span>
<a name="a8"></a><a class="code" href="_java_binding_8h.html#a0ebad81e8e051c6b3c242f456d4ebf53" title="Defines Java bindings for the current live class.">JB_DEFINE_LIVE_CLASS</a>(
    <span class="stringliteral">&quot;LiveThreadJava&quot;</span>
    ,
    NoFields
    ,
    Methods
    (
        Constructor,
        <span class="stringliteral">&quot;&lt;init&gt;&quot;</span>,<span class="stringliteral">&quot;(Ljava/lang/String;)V&quot;</span>
    )
    ,
    Callbacks
    (
         Method(Run),
        <span class="stringliteral">&quot;run&quot;</span>,<span class="stringliteral">&quot;()V&quot;</span>
    )
)

LiveThread::LiveThread(java::<a class="code" href="namespacejava.html#a2c8e044fce146c4e355d34139eb38921" title="Pointer to String.">PString</a> name):
    Thread(<a class="code" href="_java_binding_8h.html#a39836eb30974f0996efabe26e02dc297" title="Allocates new instance of Java class and calls constructor method identified by ConstructorTag.">JB_NEW</a>(Constructor,name),GetInstanceFieldID())
{
}

<span class="preprocessor">#undef JB_CURRENT_CLASS</span>
<span class="preprocessor"></span>

<span class="comment">/**************************************/</span>

<span class="preprocessor">#ifdef ONLY_FOR_DOXYGEN</span>
<span class="preprocessor"></span><span class="comment">// Wire this example to:</span>
<a name="_a9"></a><a class="code" href="classjava_1_1_object.html" title="The Object class, root of all.">java::Object</a>;
<span class="preprocessor">#endif</span>
</pre></div> </div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jun 9 2011 00:20:03 for JNIpp by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
